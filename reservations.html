<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Réservations | Général Express</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --orange: #f37021; --green: #7ab596; --dark: #2c3e50; --bg: #f4f7f6; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background: var(--bg); padding-top: 100px; }

        /* Navbar */
        .navbar { display: flex; justify-content: space-between; align-items: center; padding: 15px 5%; background: white; position: fixed; top: 0; width: 100%; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .logo { font-weight: 700; font-size: 1.4rem; color: var(--green); text-decoration: none; }
        .logo span { color: var(--orange); }
        .nav-links { display: flex; list-style: none; gap: 20px; }
        .nav-links a { text-decoration: none; color: #555; font-size: 0.9rem; }
        .nav-links a.active { color: var(--orange); font-weight: bold; }

        /* Grille de voyages */
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin-top: 30px; }
        .card { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .card-img { width: 100%; height: 150px; object-fit: cover; }
        .card-content { padding: 20px; }
        
        /* Prix Double */
        .price-row { display: flex; gap: 10px; margin-top: 15px; }
        .btn-price { flex: 1; padding: 12px; border: none; border-radius: 8px; cursor: pointer; transition: 0.3s; text-align: center; }
        .btn-classique { background: #eee; color: var(--dark); }
        .btn-vip { background: var(--orange); color: white; font-weight: bold; }
        .btn-price:hover { opacity: 0.8; transform: translateY(-2px); }

        /* Modale Billet */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; align-items: center; justify-content: center; }
        .ticket { background: white; width: 90%; max-width: 400px; border-radius: 20px; overflow: hidden; text-align: center; padding-bottom: 20px; }
        .ticket-header { background: var(--orange); color: white; padding: 20px; font-weight: bold; }
        .qr-area { padding: 20px; }
        #qr-code { width: 180px; height: 180px; }
    </style>
</head>
<body>
    <header class="navbar">
        <a href="index.html" class="logo"><i class="fas fa-bus"></i> Général<span>Express</span></a>
        <ul class="nav-links">
            <li><a href="index.html">Accueil</a></li>
            <li><a href="reservations.html" class="active">Réservations</a></li>
            <li><a href="horaires.html">Horaires</a></li>
            <li><a href="apropos.html">À propos</a></li>
            <li><a href="contact.html">Contact</a></li>
        </ul>
    </header>

    <div class="container">
        <h1>Tous nos trajets</h1>
        <div id="voyages-list" class="grid"></div>
    </div>

    <div id="modal-ticket" class="modal">
        <div class="ticket">
            <div id="t-header" class="ticket-header">BILLET DE VOYAGE</div>
            <div class="qr-area">
                <p><strong id="t-user">Nom Passager</strong></p>
                <p id="t-route">Yaoundé -> Douala</p>
                <img id="qr-code" src="" alt="QR Code">
                <p style="font-size: 0.8rem; margin-top: 10px;">Présentez ce code à l'embarquement</p>
            </div>
            <button onclick="closeModal()" style="padding: 10px 20px; cursor: pointer;">Fermer</button>
        </div>
    </div>

    <script>
        const API = "https://generalexpress-voyage-api.onrender.com/api";

        async function load() {
            const list = document.getElementById('voyages-list');
            try {
                const res = await fetch(`${API}/voyages`);
                const data = await res.json();
                list.innerHTML = data.map(v => `
                    <div class="card">
                        <img src="${v.image_url}" class="card-img">
                        <div class="card-content">
                            <h3>${v.depart} ➔ ${v.arrivee}</h3>
                            <p>Départ: ${v.heure_depart.substring(0,5)}</p>
                            <div class="price-row">
                                <button class="btn-price btn-classique" onclick="book('${v.depart}','${v.arrivee}','Classique','${v.prix_classique}')">
                                    Classique<br><strong>${v.prix_classique} F</strong>
                                </button>
                                <button class="btn-price btn-vip" onclick="book('${v.depart}','${v.arrivee}','VIP','${v.prix_vip}')">
                                    VIP<br><strong>${v.prix_vip} F</strong>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (e) { list.innerHTML = "Erreur de chargement."; }
        }

        function book(dep, arr, type, prix) {
            const nom = prompt("Nom du passager :");
            if(!nom) return;
            document.getElementById('t-user').innerText = nom;
            document.getElementById('t-route').innerText = `${dep} ➔ ${arr} (${type})`;
            document.getElementById('t-header').style.background = type === 'VIP' ? '#f37021' : '#2c3e50';
            const qrData = `PASS:${nom}|TR:${dep}-${arr}|TYP:${type}`;
            document.getElementById('qr-code').src = `https://chart.googleapis.com/chart?chs=180x180&cht=qr&chl=${encodeURIComponent(qrData)}`;
            document.getElementById('modal-ticket').style.display = 'flex';
        }

        function closeModal() { document.getElementById('modal-ticket').style.display = 'none'; }
        window.onload = load;
    </script>
</body>
</html>